#labels Building,LunarGLASS
This project is based on a copy of mesa from freedesktop.org and LLVM from llvm.org.  It makes a "stand alone" compiler stack, not integrated with a driver, that outputs text.

It is a bit cumbersome, so far done just for proof of concept purposes.  More streamlined setup and instructions will be forthcoming.

Note: This will overwrite some mesa files, so you will want to do this in a separate location than other mesa development.

== Getting the Code for Linux and Windows ==

Overview:  Mesa and LLVM will be sibling tree structures; both children of your LunarGLASS directory.  They will then be overlaid by LunarGLASS files.  

1. Make a directory (e.g., "LunarGLASS", which will be the name used in these instructions) where you want this project to live.  It will correspond to the svn/trunk/ directory in the google SVN repository for LunarGLASS.

2. To get mesa, make a directory "mesa" under "LunarGLASS".  Then get  version 7.9 of mesa:
{{{
# cd to the LunarGLASS directory you made...
cd LunarGLASS
git clone git://git.freedesktop.org/git/mesa/mesa
cd mesa
git checkout -f mesa-7.9
}}} 
You could also use the tar release, but it will be missing talloc. Verify you are left with the directory "LunarGLASS/mesa/src" et. al.

3. To get LLVM, make a directory "LLVM" under "LunarGLASS".  We are using version 2.8 of LLVM, which you download from
{{{
http://llvm.org/releases/download.html#2.8  "LLVM Source Code"
}}}
Expand this download in your "LunarGLASS/LLVM" directory.  Verify this left LLVM in the directory "LunarGLASS/LLVM/llvm-2.8".

4. To get LunarGLASS, you will need SVN commands or an SVN client like Tortoise.  Use your SVN client to check out from google's code site //lunarglass.googlecode.com/svn/trunk to your directory "LunarGLASS".

This got most the files, but did not yet replace files that need to be replace.  To do that, you must revert all files at the LunarGLASS level.  In Tortoise, right click LunarGLASS|Tortoise SVN|Revert...  

If you are using SVN from the command line, these steps look like:
{{{
# cd to the LunarGLASS directory you made...
cd LunarGLASS
svn checkout --force https://lunarglass.googlecode.com/svn/trunk/ .
svn revert --depth=infinity .
}}}

== Building ==

=== On Visual Studio 2010 ===

For LLVM, create a visual studio solution that creates all the libs and headers:

  # Download and install CMake for Windows.  We used version 2.8.3 at http://www.cmake.org/cmake/resources/software.html.
  # Run CMake as Administrator
  # Put the path to your LunarGLASS\LLVM\llvm-2.8 location in "Where is the source code:" and add "\build" to it (LunarGLASS\LLVM\llvm-2.8\build) in "Where to build the binaries:"
  # Press "Configure" button in CMake and say yes to create the build directory.
  # Select Visual Studio 2010 and "Use default native compilers" and "Finish".
  # Change CMAKE_INSTALL_PREFIX to "install" (no path).
  # Press "Configure" again.
  # Press "Generate" button in CMake.
  # Open new LLVM.sln just created in llvm-2.8\build and build the INSTALL project (not the solution, just the INSTALL project for "Debug Win32").  This step takes a while...

For LunarGLASS

  * Open "LunarGLASS/mesa/src/glsl/Standalone.sln" and build the "standalone" project.

In the directory "LunarGLASS/mesa/src/LunarGLASS/test" is a run script that shows how to execute the compiler on a test file.

=== On Linux ===

  # Install build dependencies
{{{
$ sudo apt-get install build-essential libffi-dev # maybe more...
}}}
  # Build LLVM 2.8 (with LunarGLASS modifications)
{{{
$ mkdir LLVM/llvm-2.8/build
$ cd LLVM/llvm-2.8/build
$ ../configure
$ make
$ make install DESTDIR=`pwd`/install
}}}
  # Build Mesa 7.9 (with LunarGLASS modifications)
{{{
$ cd mesa/src/glsl
$ make -f StandAlone.makefile
}}}