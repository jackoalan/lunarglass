#labels Building,LunarGLASS
This project is based on a copy of mesa from freedesktop.org and LLVM from llvm.org.  It makes a "stand alone" compiler stack, not integrated with a driver, that outputs text.

Note: This will overwrite some mesa files, so you will want to do this in a separate location than other mesa development.

== Getting the code for linux and Windows ==

Overview:  Mesa and LLVM will be sibling tree structures; both children of your LunarGLASS directory.  They will then be overlaid by LunarGLASS files.  

1. Make a directory (e.g., "LunarGLASS", which will be the name used in these instructions) where you want this project to live.  It will correspond to the svn/trunk/ directory in the google SVN repository for LunarGLASS.

2. To get mesa, make a directory "mesa" under "LunarGLASS".  Then get  version 7.9 of mesa:

{{{
cd LunarGLASS/mesa
git clone git://git.freedesktop.org/git/mesa/mesa
git checkout -f mesa-7.9
}}}
You could also use the tar release, but it will be missing talloc.  Verify you are left with the directory "LunarGLASS/mesa/src" et. al.

3. To get LLVM, make a directory "LLVM" under "LunarGLASS".  We are using version 2.8 of LLVM, which you download from
{{{
http://llvm.org/releases/download.html#2.8  "LLVM Source Code"
}}}
Expand this download in your "LunarGLASS/LLVM" directory.  Verify this left LLVM in the directory "LunarGLASS/LLVM/llvm-2.8".

4. To get LunarGLASS, use your SVN client to checkout google's code side //lunarglass.googlecode.com/svn/trunk to your directory "LunarGLASS".

This will not yet have replaced files that need to be replace.  To do that, you must use your client to revert all files.  If you are using the command line SVN, these steps look like:
{{{
cd LunarGLASS
svn checkout http://lunarglass.googlecode.com/svn/trunk/ .
svn revert --depth=infinity
}}}

== Building ==

=== For Visual Studio 2010 ===

For LLVM, create a visual studio solution that creates all the libs and headers:

1. Download and install CMake for Windows (http://www.cmake.org/cmake/resources/software.html)

2. Run CMake as Administrator

3. Put your path to LLVM\llvm-2.8 in your source code location

4. Create a folder called build in LLVM\llvm-2.8 for CMake output and place that path in "Where to build the binaries:"

5. Press "Configure" button in CMake.

6. Select the Visual Studio version you have installed. The highlight "Use default native compilers" and Finish.

7. Press "Configure" button in CMake... look for errors.  Fix them.

8. Change CMAKE_INSTALL_PREFIX to "install", which is where LLVM libraries and headers will be built
    * it is a relative path to "Where to build the binaries:"

9. Press "Generate" button in CMake.

10. Open new LLVM.sln just created in llvm-2.8\build

11. Build the INSTALL project (Note:  Not the solution, the INSTALL project itself.  This step takes a while...)

12. Now open mesa\src\glsl\Standalone.sln and build the "standalone" project.

=== For linux ===

1. Install build dependencies
{{{
$ sudo apt-get install build-essential libffi-dev # maybe more...
}}}

2. Build LLVM 2.8 (with LunarGLASS modifications)
{{{
$ mkdir LLVM/llvm-2.8/build
$ cd LLVM/llvm-2.8/build
$ ../configure
$ make
$ make install DESTDIR=`pwd`/install
}}}

3. Build Mesa 7.9 (with LunarGLASS modifications)
{{{
$ cd mesa/src/glsl
$ make -f StandAlone.makefile
}}}